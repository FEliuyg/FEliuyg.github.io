{"meta":{"title":"FEliuyg的个人博客","subtitle":null,"description":null,"author":"FEliuyg","url":"https://feliuyg.github.com"},"pages":[{"title":"","date":"2017-03-20T13:27:45.000Z","updated":"2017-03-20T13:27:45.000Z","comments":false,"path":"categories/index.html","permalink":"https://feliuyg.github.com/categories/index.html","excerpt":"","text":""},{"title":"","date":"2017-03-21T02:00:45.000Z","updated":"2017-03-21T02:00:45.000Z","comments":true,"path":"demo/guessNumber.html","permalink":"https://feliuyg.github.com/demo/guessNumber.html","excerpt":"","text":"pushstate #prompt { font-size: 16px; } table { width: 90%; margin: 10px; margin-left: 5%; } #low, #high { background-color: lightgray; height: 1em; } #mid { background-color: green; } I'm thinking of a number ... window.onload = newgame window.onpopstate = popState var state,ui function newgame (playagain) { ui = { heading: null, prompt: null, input: null, low: null, mid: null, high: null } for (var id in ui) { ui[id] = document.getElementById(id) } ui.input.onchange = handleGuess state = { n: Math.floor(99 * Math.random() + 1), low: 0, high: 100, guessnum: 0, guess: undefined } display(state) if (playagain === true) { save(state) } } function handleGuess () { var g = parseInt(this.value) if ((g > state.low) && (g < state.high)) { if (g < state.n) { state.low = g } else if (g > state.n) { state.high = g } state.guess = g state.guessnum++ save(state) display(state) } else { alert(\"Please enter a number greater than \" + state.low + \" and less than \" + state.high) } } function display (state) { ui.heading.innerHTML = document.title = \"I'm thinking of a number between \" + state.low + \" and \" + state.high + \".\" ui.low.style.width = state.low + \"%\" ui.mid.style.width = (state.high - state.low) + \"%\" ui.high.style.width = (100 - state.high) + \"%\" ui.input.style.visibility = \"visible\" ui.input.value = \"\" ui.input.focus() if (state.guess === undefined) { ui.prompt.innerHTML = \"Type your guess and hit Enter:\" } else if (state.guess < state.n) { ui.prompt.innerHTML = state.guess + \" is too low. Guess again:\" } else if (state.guess > state.n) { ui.prompt.innerHTML = state.guess + \" is too high. Guess again:\" } else { ui.input.style.visibility = \"hidden\" ui.heading.innerHTML = document.title = state.guess + \" is correct!\" ui.prompt.innerHTML = \"You win! Play Again\" } } function save (state) { if (!history.pushState) return var url = \"#guess=\" + state.guessnum history.pushState(state, \"\", url) } function popState (event) { if (event.state) { state = event.state display(state) } else { history.replaceState(state, \"\", \"#guess\" + state.guessnum) } }"},{"title":"","date":"2017-03-20T13:25:20.000Z","updated":"2017-03-20T13:25:20.000Z","comments":false,"path":"tags/index.html","permalink":"https://feliuyg.github.com/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"历史记录管理之pushState的使用","slug":"pushState","date":"2017-03-20T14:26:44.000Z","updated":"2017-03-21T02:01:44.000Z","comments":true,"path":"2017/03/20/pushState/","link":"","permalink":"https://feliuyg.github.com/2017/03/20/pushState/","excerpt":"","text":"ajax可以实现页面的无刷新，但是也带来另外一个问题，就是无法后退。这个时候pushState就派上用场了，也是无刷新的。它的作用就是，往浏览器的历史记录里塞一个地址与状态，这个时候就可以实现无刷新并且可以前进后退。与ajax的结合使用，就是俗称的pjax。 API history.pushState向浏览器的历史记录中添加一个状态 1history.pushState(state, title, url) 参数详解： state object – 状态对象，与历史记录相关。当用户定向到一个新的状态时（一般就是浏览器的前进与后退），会触发popstate事件。事件的state属性包含了历史记录的state对象。 title – 火狐浏览器忽略此参数，但考虑到将来有可能改变，传递一个空字符串是安全的做法。 url – 这个参数提供了新历史记录的地址。但浏览器在调用pushState方法之后不会去加载这个url。如果它是一个相对地址，那一定是相对于当前的url，新的url必须和当前的url在同一源下，否则会抛出异常。 注意：url中带 &#39;#&#39;或&#39;?&#39; 并不会触发onhashchange事件 history.replaceState替换浏览器历史记录的当前记录。 1history.replace(state, title, url) window.onpopstate监听历史记录状态的变化。pushState和replaceState本身不会触发该事件 123window.onpopstate = function (event) &#123; console.log(event.state);&#125; API的简单运用 pushState 123window.onload = function () &#123; history.pushState(&#123;'page': 1&#125;, '', '#page1') // 打开新的页面可以发现,浏览器的左上方出现了可以返回的按钮&#125; replaceState 123window.onload = function () &#123; history.replaceState(&#123;'page': 2&#125;, '', '#page2') // 打开新的页面可以发现,浏览器的左上方按钮还是灰的，但是地址栏上增加了一个hash值page2&#125; 完整实例–猜数字游戏 （来自《JavaSript权威指南》）demo地址 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt; &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt; &lt;title&gt;pushstate&lt;/title&gt; &lt;style&gt; #prompt &#123; font-size: 16px; &#125; table &#123; width: 90%; margin: 10px; margin-left: 5%; &#125; #low, #high &#123; background-color: lightgray; height: 1em; &#125; #mid &#123; background-color: green; &#125; &lt;/style&gt;&lt;/head&gt;&lt;body&gt; &lt;h1 id=&quot;heading&quot;&gt;I&apos;m thinking of a number ...&lt;/h1&gt; &lt;table&gt; &lt;tr&gt; &lt;td id=&quot;low&quot;&gt;&lt;/td&gt; &lt;td id=&quot;mid&quot;&gt;&lt;/td&gt; &lt;td id=&quot;high&quot;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;label id=&quot;prompt&quot;&gt;&lt;/label&gt; &lt;input type=&quot;text&quot; id=&quot;input&quot;&gt; &lt;script&gt; window.onload = newgame window.onpopstate = popState var state,ui function newgame (playagain) &#123; ui = &#123; heading: null, prompt: null, input: null, low: null, mid: null, high: null &#125; for (var id in ui) &#123; ui[id] = document.getElementById(id) &#125; ui.input.onchange = handleGuess state = &#123; n: Math.floor(99 * Math.random() + 1), low: 0, high: 100, guessnum: 0, guess: undefined &#125; display(state) if (playagain === true) &#123; save(state) &#125; &#125; function handleGuess () &#123; var g = parseInt(this.value) if ((g &gt; state.low) &amp;&amp; (g &lt; state.high)) &#123; if (g &lt; state.n) &#123; state.low = g &#125; else if (g &gt; state.n) &#123; state.high = g &#125; state.guess = g state.guessnum++ save(state) display(state) &#125; else &#123; alert(&quot;Please enter a number greater than &quot; + state.low + &quot; and less than &quot; + state.high) &#125; &#125; function display (state) &#123; ui.heading.innerHTML = document.title = &quot;I&apos;m thinking of a number between &quot; + state.low + &quot; and &quot; + state.high + &quot;.&quot; ui.low.style.width = state.low + &quot;%&quot; ui.mid.style.width = (state.high - state.low) + &quot;%&quot; ui.high.style.width = (100 - state.high) + &quot;%&quot; ui.input.style.visibility = &quot;visible&quot; ui.input.value = &quot;&quot; ui.input.focus() if (state.guess === undefined) &#123; ui.prompt.innerHTML = &quot;Type your guess and hit Enter:&quot; &#125; else if (state.guess &lt; state.n) &#123; ui.prompt.innerHTML = state.guess + &quot; is too low. Guess again:&quot; &#125; else if (state.guess &gt; state.n) &#123; ui.prompt.innerHTML = state.guess + &quot; is too high. Guess again:&quot; &#125; else &#123; ui.input.style.visibility = &quot;hidden&quot; ui.heading.innerHTML = document.title = state.guess + &quot; is correct!&quot; ui.prompt.innerHTML = &quot;You win! &lt;button onclick=&apos;newgame(true)&apos;&gt;Play Again&lt;/button&gt;&quot; &#125; &#125; function save (state) &#123; if (!history.pushState) return var url = &quot;?guess=&quot; + state.guessnum history.pushState(state, &quot;&quot;, url) &#125; function popState (event) &#123; if (event.state) &#123; state = event.state display(state) &#125; else &#123; history.replaceState(state, &quot;&quot;, &quot;#guess&quot; + state.guessnum) &#125; &#125; &lt;/script&gt;&lt;/body&gt;&lt;/html&gt;","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://feliuyg.github.com/tags/javascript/"},{"name":"前端","slug":"前端","permalink":"https://feliuyg.github.com/tags/前端/"}]}]}